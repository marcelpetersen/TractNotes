<!doctype html><html>  <head>    <meta charset="utf-8">    <base href="../">    <title>JSDoc: source : track.controller.js</title>    <link type="text/css" rel="stylesheet" href="css/jsdoc-default.css">    <link href="css/prettify-tomorrow.css" type="text/css" rel="stylesheet">    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,400,300,700" rel="stylesheet" type="text/css">    <link href="css/custom.css" type="text/css" rel="stylesheet">    <script src="js/prettify.js"></script>    <script src="js/angular.min.js"></script>  </head>  <body ng-app="">    <nav>      <h2><a href="index.html">Index</a></h2>      <ul class="module">        <!-- _ract_otes -->        <h3>          <a href="" ng-click="module_ract_otes = !module_ract_otes">            module: TractNotes          </a>          <i ng-cloak="" ng-show="module_ract_otes">+</i>        </h3>        <li id="TractNotes" ng-hide="module_ract_otes">          <ul class="group">            <h3>              <a href="" ng-click="_ract_otesfactory = !_ract_otesfactory">                factory              </a>              <i ng-cloak="" ng-show="_ract_otesfactory">+</i>            </h3>            <ul ng-hide="_ract_otesfactory">              <li>                <a href="TractNotes.drawnItemsService.html">drawnItemsService</a>              </li><li>                <a href="TractNotes.googleApi.html">googleApi</a>              </li><li>                <a href="TractNotes.importService.html">importService</a>              </li><li>                <a href="TractNotes.layerControlService.html">layerControlService</a>              </li><li>                <a href="TractNotes.locationService.html">locationService</a>              </li><li>                <a href="TractNotes.settingsService.html">settingsService</a>              </li><li>                <a href="TractNotes.trackService.html">trackService</a>              </li><li>                <a href="TractNotes.trackViewService.html">trackViewService</a>              </li>            </ul>          </ul><ul class="group">            <h3>              <a href="" ng-click="_ract_otesservice = !_ract_otesservice">                service              </a>              <i ng-cloak="" ng-show="_ract_otesservice">+</i>            </h3>            <ul ng-hide="_ract_otesservice">              <li>                <a href="TractNotes.Drive.html">Drive</a>              </li>            </ul>          </ul><ul class="group">            <h3>              <a href="" ng-click="_ract_otescontroller = !_ract_otescontroller">                controller              </a>              <i ng-cloak="" ng-show="_ract_otescontroller">+</i>            </h3>            <ul ng-hide="_ract_otescontroller">              <li>                <a href="TractNotes.DriveController.html">DriveController</a>              </li><li>                <a href="TractNotes.FormController.html">FormController</a>              </li><li>                <a href="TractNotes.MapController.html">MapController</a>              </li><li>                <a href="TractNotes.TrackController.html">TrackController</a>              </li><li>                <a href="TractNotes.TrackViewController.html">TrackViewController</a>              </li>            </ul>          </ul><ul class="group">            <h3>              <a href="" ng-click="_ract_otesmodule = !_ract_otesmodule">                module              </a>              <i ng-cloak="" ng-show="_ract_otesmodule">+</i>            </h3>            <ul ng-hide="_ract_otesmodule">              <li>                <a href="TractNotes.TractNotesApp.html">TractNotesApp</a>              </li>            </ul>          </ul>        </li>      </ul>    </nav>    <div id="content" class="page-wrap">      <h1 class="title">        source : track.controller.js      </h1>      <div id="main" class="big-container">        <!-- source code html -->        <article>          <pre class="prettyprint source linenums"><code>(function() {    'use strict';    /**     * @memberof TractNotes     * @ngdoc controller     * @name TrackController     * @param {service} $scope Application model in AngularJS     * @param {service} $rootScope Root application model in AngularJS     * @param {service} importService Track import factory     * @param {service} trackService Track creation factory     * @param {service} trackViewService Track view rendering factory     * @param {service} Drive Drive API service     * @param {service} popupService Popup storage factory     * @param {service} IonicClosePopupService Service to close popups by tapping outside popup     * @param {service} $state State service in Angular UI Router     * @property {object} vm ViewModel capture variable for *this*.     * @desc This controller manages the tracks view and maintains a list of tracks.     */    angular        .module('TractNotes')        .controller('TrackController', TrackController);    TrackController.$inject = ['$scope', '$rootScope', 'importService', 'trackService', 'trackViewService', 'Drive', 'popupService', 'IonicClosePopupService', '$state'];    /* @ngInject */    function TrackController($scope, $rootScope, importService, trackService, trackViewService, Drive, popupService, IonicClosePopupService, $state) {        var vm = this;        vm.title = 'TrackController';        vm.showDelete = false;        vm.tracks = [];        vm.importedTracks = [];        vm.importFromDevice = importFromDevice;        vm.goToDrive = goToDrive;        vm.getDriveFiles = getDriveFiles;        vm.importFromURL = importFromURL;        vm.sendTrack = sendTrack;        vm.sendTrackDelete = sendTrackDelete;        vm.getUrlInput = getUrlInput;        activate();        ////////////////        /**         * Initialize tracks and importedTracks from trackService         * @memberof TrackController         * @function activate         */        function activate() {            vm.tracks = trackService.getTracks();            vm.importedTracks = trackService.getImportedTracks();        }        /**         * Fire an import from device event on user selected file         * @memberof TrackController         * @function importFromDevice         * @fires $rootScope#Import         * @eventType emit         */        function importFromDevice() {            fileChooser.open(function(uri) {                console.log(uri);                $rootScope.$emit('Import', uri);            });        }        /**         * Ensures the user is logged in and calls getDriveFiles         * @memberof TrackController         * @function goToDrive         */        function goToDrive() {            var auth_token = gapi.auth.getToken();            if (auth_token) {                getDriveFiles();            }            else {                Drive.authenticate()                    .then(function(response) { //authenticate                            if (response) {                                gapi.auth.setToken(response);                                getDriveFiles();                            }                        },                        function(error) {                            console.log("" + error);                        });            }            //Google Picker API            // Drive.showPicker().then(function(id) {            //     vm.id = id;            //     console.log("FileSelection: success.");            //     }, function() {            //         console.log("FileSelection: error.");            //         });        }        /**         * Loads all gpx/kml files and routes to drive.html.         * @memberof TrackController         * @function getDriveFiles         */        function getDriveFiles() {            Drive.readGPXAndKML(null).then(function(files) {                console.log("FileRead: success.");                Drive.setFileList(files);                $state.go('app.drive');            }, function() {                console.log("FileRead: error.");            });        }        /**         * Fire an import from device event on import from url         * @memberof TrackController         * @function importFromURL         * @fires $rootScope#Import         * @eventType emit         * @param {string} url URL to import         */        function importFromURL(url) {            console.log('URL: ' + url);            importService.setImportURL(url);            $rootScope.$emit('Import', url);        }        /**         * Set track view to be rendered         * @memberof TrackController         * @function sendTrack         * @param {object} track Track to render         */        function sendTrack(track) {            trackViewService.setTrackView(track);        }        /**         * Fire a track remove event         * @memberof TrackController         * @function sendTrackDelete         * @fires $rootScope#RemoveTrack         * @eventType emit         * @param {object} track Track to delete         */        // @todo refactor to modify layer control in service, remove listener in map controller        function sendTrackDelete(track) {            // confirmation popup for track deletion            var trackDeletePopup = popupService.getDeletePopup(track, 'Track');            trackDeletePopup.then(function(res) {                if(res) {                    console.log('Track deletion (' + track.name + ') confirmed');                    trackService.deleteTrack(track);                    $rootScope.$emit("RemoveTrack", track)                }                else {                    console.log('Track deletion (' + track.name + ') cancelled');                }            });            IonicClosePopupService.register(trackDeletePopup);        }        /**         * Bind URL input to ViewModel         * @memberof TrackController         * @function getURLInput         */        function getUrlInput() {            // gets URL input from user and passes it to vm.importFromURL            $scope.data = {};            var trackUrlPopup = popupService.getUrlPopup($scope);            trackUrlPopup.then(function(res) {                if(res) {                    console.log('Import track from URL confirmed');                    vm.importFromURL($scope.data.urlInput);                }                else {                    console.log('Import track from URL cancelled');                }            });            IonicClosePopupService.register(trackUrlPopup);        }    }})();</code></pre>        </article>        <!-- index.html -->        <!-- class files -->      </div>      <footer style="clear:both">        Documentation generated by        <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.2</a>        using        <a href="https://github.com/allenhwkim/angular-jsdoc">Angular-JSDoc template</a>      </footer>    </div>    <!--%= prettyJson %-->    <script>      prettyPrint();      var lineNo = window.location.hash.match(/#line([0-9]+)$/);      lineNo && document.querySelector("ol li:nth-child("+(lineNo[1])+")").scrollIntoView();    </script>  </body></html>