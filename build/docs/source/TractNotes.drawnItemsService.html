<!doctype html><html>  <head>    <meta charset="utf-8">    <base href="../">    <title>JSDoc: source : drawnItems.factory.js</title>    <link type="text/css" rel="stylesheet" href="css/jsdoc-default.css">    <link href="css/prettify-tomorrow.css" type="text/css" rel="stylesheet">    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,400,300,700" rel="stylesheet" type="text/css">    <link href="css/custom.css" type="text/css" rel="stylesheet">    <script src="js/prettify.js"></script>    <script src="js/angular.min.js"></script>  </head>  <body ng-app="">    <nav>      <h2><a href="index.html">Index</a></h2>      <ul class="module">        <!-- _ract_otes -->        <h3>          <a href="" ng-click="module_ract_otes = !module_ract_otes">            module: TractNotes          </a>          <i ng-cloak="" ng-show="module_ract_otes">+</i>        </h3>        <li id="TractNotes" ng-hide="module_ract_otes">          <ul class="group">            <h3>              <a href="" ng-click="_ract_otesfactory = !_ract_otesfactory">                factory              </a>              <i ng-cloak="" ng-show="_ract_otesfactory">+</i>            </h3>            <ul ng-hide="_ract_otesfactory">              <li>                <a href="TractNotes.drawnItemsService.html">drawnItemsService</a>              </li><li>                <a href="TractNotes.googleApi.html">googleApi</a>              </li><li>                <a href="TractNotes.importService.html">importService</a>              </li><li>                <a href="TractNotes.layerControlService.html">layerControlService</a>              </li><li>                <a href="TractNotes.locationService.html">locationService</a>              </li><li>                <a href="TractNotes.settingsService.html">settingsService</a>              </li><li>                <a href="TractNotes.trackService.html">trackService</a>              </li><li>                <a href="TractNotes.trackViewService.html">trackViewService</a>              </li>            </ul>          </ul><ul class="group">            <h3>              <a href="" ng-click="_ract_otesservice = !_ract_otesservice">                service              </a>              <i ng-cloak="" ng-show="_ract_otesservice">+</i>            </h3>            <ul ng-hide="_ract_otesservice">              <li>                <a href="TractNotes.Drive.html">Drive</a>              </li>            </ul>          </ul><ul class="group">            <h3>              <a href="" ng-click="_ract_otescontroller = !_ract_otescontroller">                controller              </a>              <i ng-cloak="" ng-show="_ract_otescontroller">+</i>            </h3>            <ul ng-hide="_ract_otescontroller">              <li>                <a href="TractNotes.DriveController.html">DriveController</a>              </li><li>                <a href="TractNotes.FormController.html">FormController</a>              </li><li>                <a href="TractNotes.MapController.html">MapController</a>              </li><li>                <a href="TractNotes.TrackController.html">TrackController</a>              </li><li>                <a href="TractNotes.TrackViewController.html">TrackViewController</a>              </li>            </ul>          </ul><ul class="group">            <h3>              <a href="" ng-click="_ract_otesmodule = !_ract_otesmodule">                module              </a>              <i ng-cloak="" ng-show="_ract_otesmodule">+</i>            </h3>            <ul ng-hide="_ract_otesmodule">              <li>                <a href="TractNotes.TractNotesApp.html">TractNotesApp</a>              </li>            </ul>          </ul>        </li>      </ul>    </nav>    <div id="content" class="page-wrap">      <h1 class="title">        source : drawnItems.factory.js      </h1>      <div id="main" class="big-container">        <!-- source code html -->        <article>          <pre class="prettyprint source linenums"><code>(function() {    'use strict';    /**     * @memberof TractNotes     * @ngdoc factory     * @name drawnItemsService     * @param {service} locationService Geolocation and track creation factory     * @property {L.FeatureGroup} drawnItems Feature layer containing all items created with draw control.     * @property {object} unitsInfo Current units, abbreviation and scale factor     * @desc This factory provides functions for maintaining the feature layer associated with draw control.     */    angular        .module('TractNotes')        .factory('drawnItemsService', drawnItemsService);    drawnItemsService.$inject = ['locationService'];    /* @ngInject */    function drawnItemsService(locationService) {        var drawnItems = new L.FeatureGroup();        var unitsInfo = {            units: 'Kilometers',            unitsAbbrv: 'km',            decimalPlaces: 2,            // conversion factor from meters to new unit            scaleFactor: 1000        };        var service = {            addToDrawnItems: addToDrawnItems,            getDrawnItems: getDrawnItems,            showPolygonArea: showPolygonArea,            showPolygonAreaEdited: showPolygonAreaEdited,            getUnitsInfo: getUnitsInfo,            setUnitsInfo: setUnitsInfo,            updatePopup: updatePopup        };        return service;        ////////////////        /**         * Add a feature to drawnItems layer         * @memberof drawnItemsService         * @function addToDrawnItems         * @param {object} e GeoJSON feature         */        function addToDrawnItems(e) {            drawnItems.addLayer(e);        }        /**         * Get drawnItems layer         * @memberof drawnItemsService         * @function getDrawnItems         * @returns {L.FeatureGroup} drawnItems         */        function getDrawnItems() {            return drawnItems;        }        /**         * Show area or length of each layer on create.         * @function showPolygonArea         * @param {object} e GeoJSON feature         */        function showPolygonArea(e) {            var type = e.layerType;            var layer = e.layer;            layer.layerType = type;            if (type === 'polyline') {                addToDrawnItems(layer);                var tempLatLng = e.layer._latlngs[0];                var totalDistance = 0.00000;                for (var i = 0; i &lt; e.layer._latlngs.length; i++) {                    var latlng = e.layer._latlngs[i];                    totalDistance += tempLatLng.distanceTo(latlng);                    tempLatLng = latlng;                }                e.layer.bindPopup(((totalDistance) / unitsInfo.scaleFactor).toFixed(unitsInfo.decimalPlaces) + ' ' + unitsInfo.unitsAbbrv);                e.layer.openPopup();            } else if (type === 'circle') {                addToDrawnItems(layer);                var area = 0;                var radius = e.layer.getRadius();                area = (Math.PI) * (radius * radius);                e.layer.bindPopup((area / Math.pow(unitsInfo.scaleFactor, 2)).toFixed(unitsInfo.decimalPlaces) + ' ' + unitsInfo.unitsAbbrv + '&lt;sup>2&lt;/sup>');                e.layer.openPopup();            } else if (type === 'polygon' || type === 'rectangle') {                addToDrawnItems(layer);                e.layer.bindPopup((LGeo.area(e.layer) / Math.pow(unitsInfo.scaleFactor, 2)).toFixed(unitsInfo.decimalPlaces) + ' ' + unitsInfo.unitsAbbrv + '&lt;sup>2&lt;/sup>');                e.layer.openPopup();            } else if (type === 'marker') {                addToDrawnItems(layer);                var newLoc = layer.getLatLng();                var currentPosition = locationService.locate();                currentPosition.then(function(val) {                    var lat = val.position.coords.latitude;                    var long = val.position.coords.longitude;                    e.layer.bindPopup(((newLoc.distanceTo([lat, long])) / unitsInfo.scaleFactor).toFixed(unitsInfo.decimalPlaces) + unitsInfo.unitsAbbrv + ' from current position.');                });            } else {                addToDrawnItems(layer);            }        }        /**         * Recalculate area or length of each layer on edit.         * @function showPolygonAreaEdited         * @param {object} e GeoJSON feature         */        function showPolygonAreaEdited(e) {            e.layers.eachLayer(function(layer) {                showPolygonArea({                    layer: layer                });            });        }        /**         * Get unitsInfo         * @function getUnitsInfo         * @returns {object} unitsInfo         */        function getUnitsInfo() {            return unitsInfo;        }        /**         * Set unitsInfo units, abbreviation, decimal places, and scale factor         * @function setUnitsInfo         * @param {string} units Textual representation of units         * @param {string} unitsAbbrv Textual abbreviation of units         * @param {int} decimalPlaces Number of decimal places to display         * @param {int} scaleFactor Conversion factor to use with L.Geodesy area values         */        function setUnitsInfo(units, unitsAbbrv, decimalPlaces, scaleFactor) {            unitsInfo.units = units;            unitsInfo.unitsAbbrv = unitsAbbrv;            unitsInfo.decimalPlaces = decimalPlaces;            unitsInfo.scaleFactor = scaleFactor;            console.log(unitsInfo);        }        // update the popup info of a drawn item        // might be able to update the popup without recalculating everything, but this may be useful for updating popup info for distance from marker        function updatePopup(layer) {            var type = layer.layerType;            if (type === 'polyline') {                var tempLatLng = layer._latlngs[0];                var totalDistance = 0.00000;                for (var i = 0; i &lt; layer._latlngs.length; i++) {                    var latlng = layer._latlngs[i];                    totalDistance += tempLatLng.distanceTo(latlng);                    tempLatLng = latlng;                }                layer.bindPopup(((totalDistance) / unitsInfo.scaleFactor).toFixed(unitsInfo.decimalPlaces) + ' ' + unitsInfo.unitsAbbrv);            } else if (type === 'circle') {                var area = 0;                var radius = layer.getRadius();                area = (Math.PI) * (radius * radius);                layer.bindPopup((area / Math.pow(unitsInfo.scaleFactor, 2)).toFixed(unitsInfo.decimalPlaces) + ' ' + unitsInfo.unitsAbbrv + '&lt;sup>2&lt;/sup>');            } else if (type === 'polygon' || type === 'rectangle') {                addToDrawnItems(layer);                layer.bindPopup((LGeo.area(layer) / Math.pow(unitsInfo.scaleFactor, 2)).toFixed(unitsInfo.decimalPlaces) + ' ' + unitsInfo.unitsAbbrv + '&lt;sup>2&lt;/sup>');            } else if (type === 'marker') {                var newLoc = layer.getLatLng();                var currentPosition = locationService.locate();                currentPosition.then(function(val) {                    var lat = val.position.coords.latitude;                    var long = val.position.coords.longitude;                    layer.bindPopup(((newLoc.distanceTo([lat, long])) / unitsInfo.scaleFactor).toFixed(unitsInfo.decimalPlaces) + unitsInfo.unitsAbbrv + ' from current position.');                });            }        }    }})();</code></pre>        </article>        <!-- index.html -->        <!-- class files -->      </div>      <footer style="clear:both">        Documentation generated by        <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.2</a>        using        <a href="https://github.com/allenhwkim/angular-jsdoc">Angular-JSDoc template</a>      </footer>    </div>    <!--%= prettyJson %-->    <script>      prettyPrint();      var lineNo = window.location.hash.match(/#line([0-9]+)$/);      lineNo && document.querySelector("ol li:nth-child("+(lineNo[1])+")").scrollIntoView();    </script>  </body></html>